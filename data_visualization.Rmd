---
title: "Creating a visualization for weather data"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(tidyr)
require(ggplot2)
require(dplyr)
```

The origin of these job comes from the following reddit: <https://www.reddit.com/r/DataVizRequests/comments/ac3x0q/request_can_someone_volunteer_their_time_to/>[link]

The table was imported via the `clipboard` method. Just selected the table from excel and ran the following.  

```{r eval=FALSE}
tabla.original <- read.table("clipboard", sep = "\t", header = T)
```

I've done this on another computer and had to move to this one, so this step is not entirely reproducible. I have saved the results of this procedure in an `RData` file which will be loaded with the following code (you should rename your filepath accordingly):

```{r}
#load("~/Dropbox/R working directory/raindata workspace.RData")
tabla.original <- tabla ## creates a working table saving the original one
# View(tabla)
```

We see that table column names are not appropriate, fixing that

```{r}
colnames(tabla) <- c("month",tabla[1,-1]) ## assignt the column names to the first row of data
tabla <- tabla[-1,] ## deletes the first row by subsetting all rows but the first one (symbolized by the minus sign)

```

Now I will use the `gather()` function in order to transform the "wide" format into the "long" format. 

```{r}
tabla2 <- tabla %>% 
  mutate(season = c("Summer", "Summer", "Autumn", "Autumn", "Autumn", "Winter", "Winter", "Winter", "Spring", "Spring", "Spring", "Summmer")) %>%
   ## sort each monthly observation in a single row
  gather("Year","Rainfall", c(-month,-season)) %>%
  subset(select = c(2,1,3,4))

head(tabla2)

```

Now I will do some more tidying up in order to R understand better the variables we are using. 

```{r}
tabla2$Year <- as.integer(tabla2$Year)
tabla2$month <- factor(tabla2$month, levels = month.name)
tabla2$season <-as.factor(tabla2$season)
```


```{r}
by.year <- ggplot(tabla2, aes(x = Year, y=Rainfall))
by.year + geom_line() + facet_wrap(~month)
```
```{r}
by.year <- ggplot(tabla2, aes(x = Year, y=Rainfall))
by.year + geom_point() + facet_wrap(~season,ncol = 5)
```

```{r}
by.month <- ggplot(tabla2, aes(x = month, y=Rainfall, color = season))
by.month + geom_point() + 
  geom_smooth() 
  
```

```{r}
by.month + coord_polar() +
  geom_point(aes(color = season))
```

```{r}
## Average rainfall
by.month + coord_polar() + stat_summary_bin(fun.y = "mean", geom = "bar") 
```


```{r}
library("RColorBrewer")
blups <- brewer.pal(9,"BuPu")

## Average rainfall


ggplot(tabla2, aes(x=month, y=Year)) + coord_polar() + geom_tile(aes(fill = Rainfall)) +  #scale_fill_continuous(type = "viridis")
#scale_fill_viridis_c(option = "plasma")
#scale_fill_gradientn(colours=rev(rainbow(6)))
scale_fill_gradientn(colours = blups)


## ggsave("myplot.jpg", plot = last_plot())
```

## Trying to cut values in fixed intervals

Trying to assign a color for each interval based on the site <http://www.bom.gov.au/australia/radar/about/using_radar_images.shtml>, converting the value of mm/hr to daily values multiplying it by 24.

```{r}
clipvalues <- c(0, 4.8,   12.0,   36.0,   60.0,   96.0,  144.0,  240.0,  360.0,  480.0,  840.0, 1200.0, 1920.0, 2880.0, 4800.0, 7200.0, 8640.0)
```

The `classIntervals` function from `classInt` package uses fixed breaks. 

```{r}
clippedvalues <- classIntervals(tabla2$Rainfall, n = 14, style = "fixed", fixedBreaks = clipvalues)

#clippedvalues

hist(values(clippedvalues))
```

